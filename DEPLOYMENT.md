# Data Trust Engineering - Deployment Guide

## Overview
This guide covers deploying the Data Trust Engineering (DTE) project, which consists of:
- **Hugo static site** (`datatrustmanifesto.org`) - Documentation, manifesto, and community resources
- **Streamlit dashboard** - Interactive trust metrics visualization
- **GitHub Pages deployment** - Automated CI/CD with custom domain

## Prerequisites

### System Requirements
- **Hugo Extended v0.114+** (latest recommended)
- **Go 1.19+** (for Hugo modules)
- **Git**
- **Python 3.11+** (for Streamlit dashboard)
- **Docker** (optional, for containerized deployment)

### Hugo Installation

#### Option 1: Direct Installation
```bash
# macOS
brew install hugo

# Ubuntu/Debian  
sudo apt-get install hugo

# Windows (Chocolatey)
choco install hugo-extended

# Verify installation
hugo version  # Should show "extended" in version string
```

#### Option 2: GitHub Actions (Recommended)
Hugo is automatically installed via GitHub Actions - no local installation required.

## Project Structure & Dependencies

### Hugo Site Structure
datatrustengineering/
├── config.toml # Hugo configuration (39 lines)
├── layouts/ # Custom Hugo layouts (no external theme)
│ ├── index.html # Homepage template (98 lines)
│ └── default/ # Default page templates
│ ├── baseof.html # Base layout wrapper
│ └── single.html # Single page layout
├── static/ # Static assets (copied to root of built site)
│ ├── CNAME # Custom domain (datatrustmanifesto.org)
│ └── css/
│ └── style.css # Custom styles (255 lines)
├── content/ # Auto-generated by Hugo modules (DO NOT EDIT)
├── public/ # Build output (auto-generated)
└── .hugo_build.lock # Hugo build cache lock file


### Hugo Module Configuration
The site uses Hugo modules to mount markdown files as content:

```toml
# From config.toml - Module mounts
[[module.mounts]]
  source = "."
  target = "content"
  includeFiles = ["Manifesto.md"]

[[module.mounts]]
  source = "tools"
  target = "content/tools"
  includeFiles = ["data-trust-dashboard/DTE_Trust_Dashboard.html"]
```

### Git Repository Structure
├── .github/
│ └── workflows/
│ ├── deploy.yml # GitHub Pages deployment (85 lines)
│ └── lint.yml # Markdown linting (10 lines)
├── tools/
│ └── data-trust-dashboard/ # Streamlit application
├── docs/ # Patterns and use cases
├── community/ # Contribution guidelines


## Local Development

### 1. Hugo Site Development
```bash
# Clone repository
git clone https://github.com/datatrustengineering/DataTrustEngineering.git
cd DataTrustEngineering

# Serve locally with live reload
hugo server --bind 0.0.0.0 --port 1313

# Access at: http://localhost:1313
```

### 2. Streamlit Dashboard Development
```bash
# Navigate to dashboard directory
cd tools/data-trust-dashboard

# Create virtual environment
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Run dashboard
streamlit run app.py --server.port=8501 --server.address=0.0.0.0

# Access at: http://localhost:8501
```

### 3. Docker Development (Optional)
```bash
# Build and run both services
docker-compose up --build

# Or run individually
cd tools/data-trust-dashboard
docker build -t dte-dashboard .
docker run -p 8501:8501 dte-dashboard
```

## GitHub Pages Deployment

### Automatic Deployment
The repository uses GitHub Actions for automated deployment:

#### Workflow: `.github/workflows/deploy.yml`
- **Trigger**: Push to `main` branch or manual dispatch
- **Runner**: `ubuntu-latest`
- **Steps**:
  1. Checkout code with submodules
  2. Setup GitHub Pages
  3. Install Hugo Extended (latest)
  4. Create deployment config with correct baseURL
  5. Build site with Hugo (`hugo --gc --minify`)
  6. Upload artifact to GitHub Pages
  7. Deploy to production

#### Workflow: `.github/workflows/lint.yml`
- **Trigger**: Push or pull request
- **Runner**: `ubuntu-latest`
- **Purpose**: Markdown linting using `nosborn/github-action-markdown-cli`

### Deployment Configuration
```yaml
# Key deployment settings from deploy.yml
- name: Setup Hugo
  uses: peaceiris/actions-hugo@v2
  with:
    hugo-version: 'latest'
    extended: true

# Build command
hugo \
  --gc \
  --minify \
  --config config.deploy.toml
```

### Custom Domain Setup
The site uses a custom domain via CNAME:

#### DNS Configuration
Type: CNAME
Name: datatrustmanifesto.org
Value: datatrustengineering.github.io


#### Hugo Configuration for Custom Domain
```toml
# config.toml (local development)
baseURL = "/"

# config.deploy.toml (created by CI/CD)
baseURL = "https://datatrustengineering.github.io/DataTrustEngineering/"
```

### Build Artifacts
After successful build, the following structure is created in `public/`:
public/
├── css/
│ └── style.css
├── tools/
│ └── data-trust-dashboard/
│ └── DTE_Trust_Dashboard.html
├── Manifesto/
│ └── index.html
├── index.html
└── CNAME


## Manual Deployment (Troubleshooting)

### Build Site Locally
```bash
# Clean previous build
rm -rf public/

# Create deployment config
cp config.toml config.deploy.toml
sed -i 's|baseURL = "/"|baseURL = "https://datatrustengineering.github.io/DataTrustEngineering/"|' config.deploy.toml

# Build with Hugo
hugo \
  --gc \
  --minify \
  --config config.deploy.toml \
  --environment production

# Verify build
ls -la public/
```

### Git Operations
```bash
# Check git status
git status

# Add changes
git add .

# Commit with descriptive message
git commit -m "Update deployment configuration and documentation"

# Push to trigger deployment
git push origin main
```

## Monitoring & Troubleshooting

### GitHub Actions Monitoring
1. Go to **Actions** tab in repository
2. Click on latest workflow run
3. Check build logs for errors
4. Verify artifact upload and deployment steps

### Common Issues

#### Hugo Build Failures
```bash
# Check Hugo version
hugo version  # Must include "extended"

# Clean Hugo cache
hugo --gc

# Check for syntax errors
hugo --config config.deploy.toml
```

#### Missing CSS/Static Files
```bash
# Verify static directory exists
ls -la static/css/

# Check if files are copied during build
hugo --config config.deploy.toml
find public -name "*.css"
```

#### Custom Domain Issues
```bash
# Verify CNAME file
cat static/CNAME

# Check DNS propagation
dig datatrustmanifesto.org CNAME
```

#### Module Mount Issues
```bash
# List mounted content
hugo --config config.deploy.toml --verbose

# Check if source files exist
ls -la Manifesto.md
ls -la tools/data-trust-dashboard/DTE_Trust_Dashboard.html
```

### Performance Optimization
```bash
# Build with minification
hugo --minify --gc

# Check site size
du -sh public/

# Optimize images (if added)
hugo --gc --minify --config config.deploy.toml
```

## Security Considerations

### Repository Security
- Repository is public (required for GitHub Pages)
- No sensitive data committed
- Use environment variables for API keys
- Regular dependency updates

### GitHub Actions Security
- Uses `GITHUB_TOKEN` for authentication
- Pages deployment uses secure GitHub infrastructure
- No custom Docker images in workflows

## File Dependencies Summary

### Hugo-Specific Files
- `config.toml` - Main Hugo configuration
- `layouts/` - Custom templates (no theme dependencies)
- `static/` - Static assets served at site root
- `.hugo_build.lock` - Build cache (auto-generated)

### CI/CD Files
- `.github/workflows/deploy.yml` - Main deployment pipeline
- `.github/workflows/lint.yml` - Code quality checks

### Content Files
- `Manifesto.md` - Mounted as content via Hugo modules
- `tools/data-trust-dashboard/DTE_Trust_Dashboard.html` - Mounted as content
- `docs/` - Documentation patterns and use cases
- `community/` - Contribution guidelines

### Tool Dependencies
- `tools/data-trust-dashboard/` - Streamlit app (separate from Hugo)
- `requirements.txt` - Python dependencies for dashboard
- `Dockerfile` & `docker-compose.yml` - Containerization (optional)

---

**Last Updated**: January 2025  
**Hugo Version**: Extended v0.114+  
**Go Version**: 1.19+  
**Deployment Target**: GitHub Pages with custom domain  
**Build Time**: ~30 seconds  
**Maintainer**: Data Trust Engineering Team